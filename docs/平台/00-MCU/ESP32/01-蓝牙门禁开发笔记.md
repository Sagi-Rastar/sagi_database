
# 240615-smartconfig 配网

>API 参考： https://docs.espressif.com/projects/esp-idf/zh_CN/v5.2.2/esp32s3/api-reference/network/esp_smartconfig.html

## 1 API 参考

### 1.1 函数

#### 1.1.1 `esp_smartconfig_get_version(void)`
获取 SmartConfig 的版本。

- **返回值：**
  - SmartConfig 版本字符串。

#### 1.1.2 `esp_smartconfig_start(const smartconfig_start_config_t*config)`
启动 SmartConfig，配置 ESP 设备连接到接入点（AP）。需要通过手机 APP 广播包含目标 AP 的 SSID 和密码的特殊数据包。

- **注意：**
  1. 此 API 可以在 STA 或 softAP-STA 模式下调用。
  2. 在完成之前，不能两次调用 `esp_smartconfig_start`，请先调用 `esp_smartconfig_stop`。

- **参数：**
  - `config` - 指向 SmartConfig 启动配置结构的指针。

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

#### 1.1.3 `esp_smartconfig_stop(void)`
停止 SmartConfig，释放由 `esp_smartconfig_start` 占用的缓冲区。

- **注意：**
  无论是否成功连接到 AP，都应该调用此 API 以释放由 `smartconfig_start` 占用的内存。

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

#### 1.1.4 `esp_esptouch_set_timeout(uint8_t time_s)`
设置 SmartConfig 过程的超时时间。

- **注意：**
  计时从 `SC_STATUS_FIND_CHANNEL` 状态开始。如果超时，SmartConfig 将重新启动。

- **参数：**
  - `time_s` - 范围 15 秒到 255 秒，偏移量：45 秒。

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

#### 1.1.5 `esp_smartconfig_set_type(smartconfig_type_t type)`
设置 SmartConfig 的协议类型。

- **注意：**
  如果用户需要设置 SmartConfig 类型，请在调用 `esp_smartconfig_start` 之前设置。

- **参数：**
  - `type` - 从 `smartconfig_type_t` 中选择。

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

#### 1.1.6 `esp_smartconfig_fast_mode(bool enable)`
设置 SmartConfig 的模式，默认为普通模式。

- **注意：**
  1. 请在调用 API `esp_smartconfig_start` 之前调用它。
  2. 快速模式需要相应的 APP（手机）。
  3. 两种模式兼容。

- **参数：**
  - `enable` - false-禁用（默认）; true-启用。

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

#### 1.1.7 `esp_smartconfig_get_rvd_data(uint8_t*rvd_data, uint8_t len)`
获取 ESPTouch v2 的保留数据。

- **参数：**
  - `rvd_data` - 保留数据
  - `len` - 保留数据的长度

- **返回值：**
  - `ESP_OK`：成功
  - 其他：失败

### 1.2 结构体

#### 1.2.1 `smartconfig_event_got_ssid_pswd_t`
SC_EVENT_GOT_SSID_PSWD 事件的参数结构体。

- **公共成员：**
  - `uint8_t ssid[32]` - 接入点（AP）的 SSID。以空字符终止的字符串。
  - `uint8_t password[64]` - 接入点的密码。以空字符终止的字符串。
  - `bool bssid_set` - 是否设置了目标 AP 的 MAC 地址。
  - `uint8_t bssid[6]` - 目标 AP 的 MAC 地址。
  - `smartconfig_type_t type` - SmartConfig 的类型（ESPTouch 或 AirKiss）。
  - `uint8_t token` - 来自手机的令牌，用于向手机发送确认（ACK）。
  - `uint8_t cellphone_ip[4]` - 手机的 IP 地址。

#### 1.2.2 `smartconfig_start_config_t`
`esp_smartconfig_start` 的配置结构。

- **公共成员：**
  - `bool enable_log` - 启用 SmartConfig 日志。
  - `bool esp_touch_v2_enable_crypt` - 启用 ESPTouch v2 加密。
  - `char* esp_touch_v2_key` - ESPTouch v2 加密密钥，长度应为 16。

### 1.3 宏定义

#### 1.3.1 `SMARTCONFIG_START_CONFIG_DEFAULT()`
默认的 SmartConfig 启动配置。

### 1.4 枚举

#### 1.4.1 `smartconfig_type_t`
- **值：**
  - `SC_TYPE_ESPTOUCH` - 协议：ESPTouch
  - `SC_TYPE_AIRKISS` - 协议：AirKiss
  - `SC_TYPE_ESPTOUCH_AIRKISS` - 协议：ESPTouch 和 AirKiss
  - `SC_TYPE_ESPTOUCH_V2` - 协议：ESPTouch v2

#### 1.4.2 `smartconfig_event_t`
SmartConfig 事件声明。

- **值：**
  - `SC_EVENT_SCAN_DONE` - 智能配置的 STA 已完成对 AP 的扫描
  - `SC_EVENT_FOUND_CHANNEL` - 智能配置的 STA 已找到目标 AP 的信道
  - `SC_EVENT_GOT_SSID_PSWD` - 智能配置的 STA 已获取 SSID 和密码
  - `SC_EVENT_SEND_ACK_DONE` - 智能配置的 STA 已向手机发送确认（ACK）

# 240617-IDF 的事件循环

